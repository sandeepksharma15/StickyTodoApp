<Window x:Class="StickyTodoApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:models="clr-namespace:StickyTodoApp.Models"
        Title="StickyTodo"
        Width="385" Height="400"
        MinWidth="200" MinHeight="200"
        WindowStyle="None"
        ResizeMode="CanResize"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="False"
        Topmost="False">

    <Border Background="{StaticResource NoteGreen}"
            BorderBrush="{StaticResource NoteBorder}"
            BorderThickness="2"
            CornerRadius="16"
            Padding="12">

        <Border.Effect>
            <DropShadowEffect BlurRadius="20"
                              Opacity="0.35"
                              ShadowDepth="4"
                              Color="Black"/>
        </Border.Effect>

        <StackPanel>
            <TextBlock Text="Sticky TODO"
               FontSize="20"
               FontWeight="Bold"
               Foreground="Black"
               HorizontalAlignment="Center"
               Margin="0,0,0,8"/>

            <!-- Input area -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBox Width="120"
                 Text="{Binding NewTitle, UpdateSourceTrigger=PropertyChanged}"
                 VerticalAlignment="Center"
                 KeyDown="TextBox_KeyDown"/>
                <ComboBox Width="70"
                  Margin="6,0,0,0"
                  ItemsSource="{Binding PriorityValues}"
                  SelectedItem="{Binding NewPriority}"
                  VerticalAlignment="Center"/>
                <DatePicker Width="120"
                    Margin="6,0,0,0"
                    SelectedDate="{Binding NewDueDate}"
                    VerticalAlignment="Center"/>
                <Button Content="Add"
                Margin="6,0,0,0"
                Command="{Binding AddCommand}"
                VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Open Items -->
            <ItemsControl ItemsSource="{Binding OpenItems}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <!-- Done checkbox -->
                            <CheckBox IsChecked="{Binding IsDone, Mode=TwoWay}"
                          Margin="0,0,6,0"/>

                            <!-- Editable title -->
                            <TextBox Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Width="120"
                         Margin="0,0,6,0"/>

                            <!-- Priority combo -->
                            <ComboBox Width="70"
                                ItemsSource="{Binding DataContext.PriorityValues, RelativeSource={RelativeSource AncestorType=Window}}"
                                SelectedItem="{Binding Priority, Mode=TwoWay}"
                                Margin="0,0,6,0"/>

                            <!-- Due date -->
                            <DatePicker SelectedDate="{Binding DueDate, Mode=TwoWay}"
                            Width="120"/>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <Separator Margin="0,8,0,8"/>

            <!-- Done Items -->
            <ItemsControl ItemsSource="{Binding DoneItems}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <CheckBox IsChecked="{Binding IsDone, Mode=TwoWay}" Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding Title}" Foreground="Gray" TextDecorations="Strikethrough"/>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Archive toggle button -->
            <ToggleButton Content="{Binding ShowArchive, Converter={StaticResource BoolToArchiveTextConverter}}"
              IsChecked="{Binding ShowArchive}"
              Margin="0,8,0,0"
              HorizontalAlignment="Center"/>

            <!-- Archived Items -->
            <Border BorderThickness="1" BorderBrush="#DDD" CornerRadius="6" Padding="6"
                    Visibility="{Binding ShowArchive, Converter={StaticResource BoolToVisibilityConverter}}"
                    Margin="0,8,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="150">
                    <ItemsControl ItemsSource="{Binding ArchivedItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="{Binding Title}"
                                   Foreground="Gray"/>
                                    <TextBlock Text="{Binding CompletedOn, StringFormat=' (done {0:dd-MMM})'}"
                                   Foreground="DarkGray"
                                   Margin="4,0,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
            <TextBlock Text="No archived items"
                    Foreground="DarkGray"
                    FontStyle="Italic"
                    HorizontalAlignment="Center"
                    Margin="4">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding ShowArchive}" Value="True"/>
                                    <Condition Binding="{Binding ArchivedItems.Count}" Value="0"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </StackPanel>
    </Border>
</Window>
